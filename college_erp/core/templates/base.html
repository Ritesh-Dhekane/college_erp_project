{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>{% block title %}College ERP{% endblock %}</title>

  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet" />
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet" />

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" />

  <!-- Custom CSS -->
  <link rel="stylesheet" href="{% static 'css/style.css' %}" />

  <style>
    /* Flex layout to make footer stick to bottom */
    html,
    body {
      height: 100%;
      margin: 0;
    }

    body {
      display: flex;
      flex-direction: column;
    }

    main {
      flex: 1 0 auto;
      /* allow main content to grow and push footer down */
    }

    footer {
      flex-shrink: 0;
      /* footer does not shrink */
    }
  </style>
</head>

<body>

<!-- Navbar -->
<nav class="navbar navbar-expand-lg navbar-dark bg-gradient-primary shadow-sm">
  <div class="container-fluid d-flex justify-content-between align-items-center px-4">
    <div class="d-flex align-items-center">
      {% if request.user.is_authenticated %}
        <!-- Sidebar reopen button (visible on md+ screens) -->
        <button id="sidebarReopenBtn" class="btn btn-outline-light btn-sm me-3 d-none d-md-inline-flex align-items-center" type="button" aria-label="Open sidebar">
          <i class="bi bi-list"></i>
        </button>
      {% endif %}

      <!-- Logo + Project Name -->
      <a class="navbar-brand fw-bold d-flex align-items-center" href="{% url 'core:home' %}">
        ðŸŽ“ College ERP
      </a>
    </div>

    <!-- Right: Profile / Login-Register -->
    <div class="d-flex align-items-center">
      {% if request.user.is_authenticated %}
        <!-- Profile dropdown -->
        <div class="dropdown">
          <a class="d-flex align-items-center text-white text-decoration-none dropdown-toggle" href="#" role="button"
            id="profileDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            <div class="rounded-circle bg-white text-primary d-flex justify-content-center align-items-center"
                 style="width: 40px; height: 40px; font-weight: 600;">
              {{ request.user.first_name|first|upper }}
            </div>
          </a>
          <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="profileDropdown">
            <li class="dropdown-item-text fw-bold">
              {{ request.user.first_name }} {{ request.user.last_name }}
            </li>
            <li class="dropdown-item-text text-muted">
              {{ request.user.role|capfirst }}
            </li>
            <li><hr class="dropdown-divider" /></li>
            <li><a class="dropdown-item" href="{% url 'core:logout' %}">Logout</a></li>
          </ul>
        </div>
      {% else %}
        <!-- Login / Register buttons -->
        <a href="{% url 'core:login' %}" class="btn btn-outline-light me-2">Login</a>
        <a href="{% url 'core:register' %}" class="btn btn-light">Register</a>
      {% endif %}
    </div>
  </div>
</nav>



  <div class="d-flex flex-grow-1 position-relative">

    {% block sidebar %}{% endblock %}
    <main class="flex-grow-1 p-4 content-area">
      {% block content %}{% endblock %}
    </main>
  </div>

  <!-- Footer -->
  <footer class="bg-dark bg-gradient text-white py-4 mt-auto shadow-lg">
    <div class="container text-center small d-flex flex-column flex-md-row justify-content-between align-items-center">
      <p class="mb-2 mb-md-0">&copy; {% now "Y" %} College ERP</p>
      <div>
        <a href="#" class="text-white text-decoration-none mx-2 footer-link">About</a>
        Â·
        <a href="#" class="text-white text-decoration-none mx-2 footer-link">Contact</a>
        Â·
        <a href="#" class="text-white text-decoration-none mx-2 footer-link">Privacy</a>
      </div>
    </div>
  </footer>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"></script>
</body>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const sidebarMenu = document.getElementById("sidebarMenu");
    const sidebar = sidebarMenu ? sidebarMenu.closest("nav") : null;

    if (!sidebar) return;

    // Apply floating style for small screens
    function handleResize() {
      if (window.innerWidth <= 768) {
        sidebar.classList.add("sidebar-float");
        sidebar.classList.remove("sidebar-static");
        // Collapse automatically when resizing down to mobile
        if (sidebarMenu.classList.contains("show")) {
          const collapseInstance = bootstrap.Collapse.getOrCreateInstance(sidebarMenu);
          collapseInstance.hide();
        }
      } else {
        sidebar.classList.remove("sidebar-float");
        sidebar.classList.add("sidebar-static");
      }
    }

    // Collapse sidebar automatically after link click (on mobile)
    sidebar.addEventListener("click", function (e) {
      if (window.innerWidth <= 768 && e.target.closest("a.nav-link")) {
        const collapseInstance = bootstrap.Collapse.getOrCreateInstance(sidebarMenu);
        collapseInstance.hide();
      }
    });

    window.addEventListener("resize", handleResize);
    handleResize();
  });
</script>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const sidebarMenu = document.getElementById("sidebarMenu");
    const sidebar = sidebarMenu ? sidebarMenu.closest("nav") : null;
    const reopenBtn = document.getElementById("sidebarReopenBtn");

    if (!sidebarMenu || !sidebar) return;

    function getCollapse() {
      return bootstrap.Collapse.getOrCreateInstance(sidebarMenu, { toggle: false });
    }

    // Reopen button for desktop
    if (reopenBtn) {
      reopenBtn.addEventListener("click", function (e) {
        e.preventDefault();
        getCollapse().show();
        sidebar.classList.remove("sidebar-collapsed");
      });
    }

    // Resize handling for mobile floating sidebar
    function handleResize() {
      if (window.innerWidth <= 768) {
        sidebar.classList.add("sidebar-float");
        sidebar.classList.remove("sidebar-static");
        if (sidebarMenu.classList.contains("show")) {
          const collapseInstance = bootstrap.Collapse.getOrCreateInstance(sidebarMenu);
          collapseInstance.hide();
        }
      } else {
        sidebar.classList.remove("sidebar-float");
        sidebar.classList.add("sidebar-static");
      }
    }

    // Auto-close sidebar on mobile link click
    sidebar.addEventListener("click", function (e) {
      if (window.innerWidth <= 768 && e.target.closest("a.nav-link")) {
        const collapseInstance = bootstrap.Collapse.getOrCreateInstance(sidebarMenu);
        collapseInstance.hide();
      }
    });

    window.addEventListener("resize", handleResize);
    handleResize();
  });
</script>


</html>